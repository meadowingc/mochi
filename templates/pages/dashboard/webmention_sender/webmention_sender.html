{% extends "/layouts/standard.html" %}

{% macro Title %}Webmention Sender{% end %}

{% macro Body %}
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
    <h1 class="text-xl font-bold text-gray-900">Webmention Sender</h1>
  </div>

  <!-- Tabs -->
  <div class="mt-3 border-b border-stone-200">
    <nav class="-mb-px flex space-x-6">
      <a href="/dashboard" class="border-transparent text-gray-400 hover:text-gray-600 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm cursor-pointer transition-colors">
        Sites
      </a>
      <a href="/dashboard/webmention-sender" class="border-indigo-500 text-indigo-600 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm cursor-pointer">
        Webmention Sender
      </a>
      <a href="/dashboard/settings" class="border-transparent text-gray-400 hover:text-gray-600 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm cursor-pointer transition-colors">
        Settings
      </a>
    </nav>
  </div>

  <!-- Process single URL -->
  <div class="mt-8">
    <h2 class="text-xs font-semibold uppercase tracking-wider text-gray-400 mb-3">Process URL Now</h2>
    <form method="POST" action="/dashboard/webmention-sender/process">
      {{ csrfField }}
      <div class="flex gap-3 items-start">
        <input
          type="text"
          name="process-url"
          id="process-url"
          placeholder="https://example.com/your-post"
          class="flex-1 text-sm border border-gray-300 rounded-md px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none"
          required
        />
        <div class="flex items-center gap-3 shrink-0">
          <label for="is-rss" class="flex items-center gap-1.5 text-sm text-gray-600 cursor-pointer">
            <input type="checkbox" id="is-rss" name="is-rss" class="h-3.5 w-3.5 text-indigo-600 border-gray-300 rounded">
            RSS
          </label>
          <button type="submit"
                  class="px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors cursor-pointer">
            Process
          </button>
        </div>
      </div>
      <p class="mt-1.5 text-xs text-gray-400">Checks the URL for links and sends webmentions immediately. Toggle RSS if processing a feed.</p>
    </form>
  </div>

  <!-- Monitored URLs -->
  {% rssFeedURLs := "" %}
  {% webPageURLs := "" %}
  {% for url in monitoredURLs %}
    {% if url.IsRSS %}
      {% rssFeedURLs = rssFeedURLs + url.URL + "\n" %}
    {% else %}
      {% webPageURLs = webPageURLs + url.URL + "\n" %}
    {% end %}
  {% end %}

  <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- RSS Feeds -->
    <div>
      <h2 class="text-xs font-semibold uppercase tracking-wider text-gray-400 mb-3">RSS Feeds</h2>
      <form method="POST" action="/dashboard/webmention-sender/add">
        {{ csrfField }}
        <input type="hidden" name="is-rss" value="true">
        <textarea
          id="rss-urls"
          name="rss-urls"
          rows="4"
          class="block w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none font-mono"
          placeholder="https://example.com/feed.xml&#10;https://another-site.com/rss"
        >{% if rssFeedURLs %}{{ rssFeedURLs }}{% end %}</textarea>
        <div class="mt-2 flex items-center justify-between">
          <p class="text-xs text-gray-400">One URL per line · checked weekly</p>
          <button type="submit"
                  class="px-3 py-1.5 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors cursor-pointer">
            Save
          </button>
        </div>
      </form>
    </div>

    <!-- Web Pages -->
    <div>
      <h2 class="text-xs font-semibold uppercase tracking-wider text-gray-400 mb-3">Web Pages</h2>
      <form method="POST" action="/dashboard/webmention-sender/add">
        {{ csrfField }}
        <input type="hidden" name="is-rss" value="false">
        <textarea
          id="page-urls"
          name="page-urls"
          rows="4"
          class="block w-full text-sm border border-gray-300 rounded-md px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none font-mono"
          placeholder="https://example.com/my-post&#10;https://example.com/another-post"
        >{% if webPageURLs %}{{ webPageURLs }}{% end %}</textarea>
        <div class="mt-2 flex items-center justify-between">
          <p class="text-xs text-gray-400">One URL per line · checked weekly</p>
          <button type="submit"
                  class="px-3 py-1.5 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors cursor-pointer">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Recent sent webmentions -->
  {% if sentWebmentions and len(sentWebmentions) > 0 %}
  <div class="mt-8">
    <h2 class="text-xs font-semibold uppercase tracking-wider text-gray-400 mb-3">Recent Sent Webmentions</h2>
    <div class="overflow-x-auto border border-stone-200 rounded-lg">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="border-b border-stone-200">
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Source</th>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Target</th>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for wm in sentWebmentions %}
          <tr>
            <td class="px-3 py-2 text-gray-600 truncate max-w-[200px]">{{ wm.SourceURL }}</td>
            <td class="px-3 py-2 text-gray-600 truncate max-w-[200px]">{{ wm.TargetURL }}</td>
            <td class="px-3 py-2">
              {% if wm.StatusCode >= 200 and wm.StatusCode < 300 %}
              <span class="text-xs font-medium text-green-700">✓ {{ wm.StatusCode }}</span>
              {% else %}
              <span class="text-xs font-medium text-red-600">✗ {{ wm.StatusCode }}</span>
              {% end %}
            </td>
            <td class="px-3 py-2 text-gray-400 text-xs">{{ wm.CreatedAt.Format("Jan 2, 2006") }}</td>
          </tr>
          {% end %}
        </tbody>
      </table>
    </div>
  </div>
  {% end %}

{% end %}
