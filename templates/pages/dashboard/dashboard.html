{% extends "/layouts/standard.html" %}

{% macro Title %}Dashboard{% end %}

{% macro Body %}
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
    <h1 class="text-xl font-bold text-gray-900">Your Sites</h1>
    <button
      id="create-site-button"
      onclick="toggleCreateSiteForm()"
      class="inline-flex items-center py-1.5 px-3 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors cursor-pointer"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
      </svg>
      Add Site
    </button>
  </div>

  <!-- Tabs -->
  <div class="mt-3 border-b border-gray-200">
    <nav class="-mb-px flex space-x-6">
      <a href="/dashboard" class="border-indigo-500 text-indigo-600 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm cursor-pointer">
        Sites
      </a>
      <a href="/dashboard/webmention-sender" class="border-transparent text-gray-400 hover:text-gray-600 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm cursor-pointer transition-colors">
        Webmention Sender
      </a>
      <a href="/dashboard/settings" class="border-transparent text-gray-400 hover:text-gray-600 hover:border-gray-300 whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm cursor-pointer transition-colors">
        Settings
      </a>
    </nav>
  </div>

  <!-- Create site form -->
  <form id="create-site-form" method="POST" class="mt-6 hidden" action="/dashboard/create-site">
    {{ csrfField }}
    <div class="border border-gray-200 rounded-lg p-4">
      <label for="url" class="block text-sm font-medium text-gray-700 mb-1">Site URL</label>
      <div class="flex gap-3">
        <input type="url" name="url" id="url" required
               placeholder="https://example.com"
               class="flex-1 text-sm border border-gray-300 rounded-md px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500 focus:outline-none">
        <button type="submit"
                class="px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors cursor-pointer">
          Add
        </button>
        <button type="button" onclick="toggleCreateSiteForm()"
                class="px-4 py-2 text-sm font-medium rounded-md text-gray-600 hover:text-gray-800 border border-gray-300 hover:bg-gray-50 transition-colors cursor-pointer">
          Cancel
        </button>
      </div>
      <p class="mt-1.5 text-xs text-gray-400">Include the protocol (https://)</p>
    </div>
  </form>

  <!-- Sites list -->
  {% if len(userSites) > 0 %}
  <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
    {% for site in userSites %}
    <a href="/dashboard/{{ site.ID }}/analytics" class="block border border-gray-200 rounded-lg p-4 hover:border-indigo-300 hover:shadow-sm transition-all group">
      <div class="flex items-center justify-between">
        <span class="text-sm font-medium text-gray-900 truncate group-hover:text-indigo-600 transition-colors">{{ site.URL }}</span>
        <svg class="h-4 w-4 text-gray-300 group-hover:text-indigo-400 transition-colors shrink-0 ml-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
        </svg>
      </div>
      <div class="mt-3 flex items-baseline gap-4">
        <div>
          <span class="text-lg font-semibold text-gray-900">{{ siteStats[site.ID].TodayHits }}</span>
          <span class="text-xs text-gray-400 ml-1">today</span>
        </div>
        <div>
          <span class="text-lg font-semibold text-gray-900">{{ siteStats[site.ID].TotalHits }}</span>
          <span class="text-xs text-gray-400 ml-1">total</span>
        </div>
        {% if siteStats[site.ID].TotalKudos > 0 %}
        <div>
          <span class="text-lg font-semibold text-gray-900">{{ siteStats[site.ID].TotalKudos }}</span>
          <span class="text-xs text-gray-400 ml-1">kudos</span>
        </div>
        {% end %}
      </div>
    </a>
    {% end %}
  </div>
  {% else %}
  <!-- Empty state -->
  <div class="mt-16 text-center">
    <span class="text-4xl">üç°</span>
    <h3 class="mt-3 text-sm font-medium text-gray-700">No sites yet</h3>
    <p class="mt-1 text-sm text-gray-400">Add your first site to start tracking.</p>
    <div class="mt-4">
      <button
        type="button"
        onclick="toggleCreateSiteForm()"
        class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors cursor-pointer"
      >
        Add Your First Site
      </button>
    </div>
  </div>
  {% end %}

  <script>
    function toggleCreateSiteForm() {
      var form = document.getElementById('create-site-form');
      var button = document.getElementById('create-site-button');
      if (form.classList.contains('hidden')) {
        form.classList.remove('hidden');
        button.classList.add('hidden');
      } else {
        form.classList.add('hidden');
        button.classList.remove('hidden');
      }
    }
  </script>
{% end %}
